<div class="row" style="padding:15px;">
 <table id="accordion" class="table table-hover table-bordered table-edit">
  <thead>
   <tr>
    <th>Year</th>
    <th>Estimated Cost</th>
    <th>Quarter</th>
    <th>EstimatedTargetLevel</th>
    <th>End Date</th>
    <th></th>
   </tr>
  </thead>
  <tbody *ngFor="let tdl of department.opiAnnualTargets;let at=index;">
   <tr>
    <td [attr.rowspan]="tdl.levels.length+4" style="vertical-align: middle;">{{tdl.year}}</td>
    <td [attr.rowspan]="tdl.levels.length+4" style="vertical-align: middle;">{{tdl.estimatedCost}}</td>
   </tr>
   <ng-template let-lev ngFor [ngForOf]="tdl.levels" let-in="index">
    <tr [style.background]="lev.disable?'lightgray':null">
     <td>{{lev.quarter}}</td>
     <td>{{lev.estimatedTargetLevel}}</td>
     <td>{{lev.endDate + tdl.year}}</td>
     <td>
      <button class="btn-link" data-toggle="collapse" [attr.data-target]="'#row-collapse'+d+'d'+at+'lev'+in" (click)="collapseOff('#row-collapse'+d+'d'+at+'lev'+in, lev)"
       style="cursor:pointer;">view</button>
     </td>
    </tr>
    <ng-container>
     <tr [attr.id]="'row-collapse'+d+'d'+at+'lev'+in" class="collapse collapse-off">
      <td colspan="5">
       <table class="table table-bordered" *ngIf="lev.mouDetails.length">
        <caption align="top">
         <div class="input-group">
          <div class="input-group-addon">Current Cost</div>
          <input class="form-control" [(ngModel)]="lev.currentCost" style="width:25%" [disabled]="!lev.edit" autofocus>
          <div class="pull-left" *ngIf="!lev.edit;else savebtn" [hidden]="lev.disable">
           <button type="button" class="btn btn-link" (click)="lev.edit=true;lev.currentCostCopy=lev.currentCost;">
            <i class="glyphicon glyphicon-pencil"></i>
           </button>
          </div>

          <ng-template #savebtn>
           <button type="button" class="btn btn-link" (click)="updateCurrentCost(lev);">
            <i class="glyphicon glyphicon-floppy-saved"></i>
           </button>
           <button type="button" class="btn btn-link" (click)="lev.edit = false;lev.currentCost=lev.currentCostCopy;">
            <i class="glyphicon glyphicon-remove"></i>
           </button>
          </ng-template>

          <div class="pull-right">
           <button class="btn" (click)="lockQuarterResult(lev)" *ngIf="lev.mouDetails.length" [disabled]="lev.status=='locked'" [disabled]="lev.disable">Lock </button>
          </div>
         </div>
        </caption>
        <colgroup>
         <col style="width:5%">
         <col style="width:25%">
         <col style="width:25%">
         <col style="width:25%">
         <col style="width:20%" [hidden]="lev.disable">
        </colgroup>
        <thead>
         <tr>
          <th>*</th>
          <th>Mou Type</th>
          <th>Organisation</th>
          <th>Evidence</th>
          <th [hidden]="lev.disable">
           <button type="button" *ngIf="lev.mouDetails.length" (click)="lev.addMore=true;">Add More</button>
          </th>
         </tr>
        </thead>
        <tbody *ngFor="let detail of lev.mouDetails;let d=index;">
         <tr>
          <td rowspan="2">{{d+1}}</td>
          <ng-container *ngIf="!detail.edit; else editable">
           <td>
            {{detail.mouType}}
           </td>
           <td>
            {{detail.organization}}
           </td>
          </ng-container>
          <ng-template #editable>
           <td>
            <input class="form-control" [(ngModel)]="detail.mouType">
           </td>
           <td>
            <input class="form-control" [(ngModel)]="detail.organization">
           </td>
          </ng-template>
          <td>
           <div class="dropdown">
            <strong>Evidence </strong>:
            <a class="btn btn-link dropdown-toggle" type="button" id="menu1" data-toggle="dropdown" style="padding: 0px;">files
             <span class="caret"></span>
            </a>
            <ul class="dropdown-menu" role="menu" aria-labelledby="menu1" style="right: 0;left:unset;font-size:12px;">
             <li role="presentation" *ngFor="let ev of detail.evidance;let e = index;" style="padding: 0px 2px 0px 2px;">
              <a class="btn-link" role="menuitem" tabindex="-1" [attr.href]="ev.url" style="float:left;padding-left:10px;">evidance {{e+1}}</a>
              <button type="button" class="close" (click)="deleteEvidence(detail.evidance,ev,e)" [hidden]="detail.status=='locked'">
               <span aria-hidden="true">&times;</span>
              </button>
             </li>
             <li class="text-center" role="presentation" *ngIf="!detail.evidance.length">None</li>
             <li role="presentation" class="divider" style="clear: both;"></li>
             <li class="text-center" role="presentation">
              <button (click)="selectMou(detail,lev);" data-toggle="modal" data-target="#evidenceForm">Upload</button>
             </li>
            </ul>
           </div>
          </td>
          <td [hidden]="lev.disable">
           <ng-container *ngIf="!detail.edit; else editableBtn">
            <button type="button" (click)="detail.edit=true;detail.mouTypeCopy=detail.mouType;detail.organizationCopy=detail.organization;">
             Edit</button>
           </ng-container>
           <ng-template #editableBtn>
            <button type="button" (click)="updateMou(detail)">save </button>
            <button type="button" (click)="detail.edit=false;detail.mouType=detail.mouTypeCopy;detail.organization=detail.organizationCopy;">Cancel </button>
           </ng-template>
          </td>
         </tr>
        </tbody>
        <tfoot *ngIf="lev.addMore">
         <tr>
          <td></td>
          <td>
           <input class="form-control" [(ngModel)]="lev.mouType">
          </td>
          <td>
           <input class="form-control" [(ngModel)]="lev.organization">
          </td>
          <td colspan="2">
           <button type="button" (click)="saveQuarterResultWithMou(lev)">save </button>
           <button type="button" *ngIf="lev.addMore" (click)="lev.addMore=false;">Cancel </button>
          </td>
         </tr>
        </tfoot>
       </table>
       <div class="row" *ngIf="!lev.mouDetails.length">
        <div class="col-sm-3">
         <div class="input-group">
          <div class="input-group-addon bg-color">Current Cost</div>
          <input type="text" class="form-control" [(ngModel)]="lev.currentCost" [disabled]="lev.disable">
         </div>
        </div>
        <div class="col-sm-3">
         <div class="input-group">
          <div class="input-group-addon bg-color">Mou type</div>
          <input type="text" class="form-control" [(ngModel)]="lev.mouType" [disabled]="lev.disable">
         </div>
        </div>
        <div class="col-sm-3">
         <div class="input-group">
          <div class="input-group-addon bg-color">Organization</div>
          <input type="text" class="form-control" [(ngModel)]="lev.organization" [disabled]="lev.disable">
         </div>
        </div>
        <div class="col-sm-3">
         <div class="form-group">
          <button class="btn pull-right btn-save" type="button" (click)="saveQuarterResultWithMou(lev)" [disabled]="lev.disable"> Save</button>
         </div>
        </div>
       </div>
      </td>
     </tr>
    </ng-container>
   </ng-template>
  </tbody>
 </table>
</div>
