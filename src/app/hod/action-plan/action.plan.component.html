<!-- subheader -->
<div class="subheader">
    <div class="nav">
      <button class="btn btn-link" type="button" routerlink="/">
        <i class="fas fa-arrow-left"></i>
      </button>
    </div>
    <div class="title">
        <span *ngIf="!my; else mystep;">All Action Steps</span>
        <ng-template #mystep>
            <h2>Span</h2>
          </ng-template>
    </div>
  </div>
  <!-- end of subheader -->
<div class="container-fluid">
  <!-- <h2 *ngIf="!my; else mystep;">All Action Steps</h2>
  <ng-template #mystep>
    <h2>My Action Steps</h2>
  </ng-template> -->
  <div id="accordion">
    <div *ngFor="let data of actionSteps;let s = index;">
        <h4 class="panel-title">{{s+1}}. KPI :
          <a data-toggle="collapse" data-parent="#accordion" [attr.href]="'#collapse'+ s">{{data.opi}}</a>
        </h4>
      <div [attr.id]="'collapse'+ s" class="panel-collapse collapse" [ngClass]="!s?'in':''">

        <div>
          <div class="row">
            <div class="col-lg-2">
              <label>Strategic Goal</label>
            </div>
            <div class="col-lg-10">
              {{data.goal}}
            </div>
          </div>
          <div class="row">
            <div class="col-lg-2">
              <label>Initiative</label>
            </div>
            <div class="col-lg-10">
              {{data.initiative}}
            </div>
          </div>
          <div class="row">
            <div class="col-lg-2">
              <label>Activity </label>
            </div>
            <div class="col-lg-10">
              {{data.activity}}
            </div>
          </div>
          <div [attr.id]="'accordion'+s">
            <fieldset  *ngFor="let dept of data.departmentInfo;let d = index;">
              <legend [attr.data-parent]="'#accordion'+s" [attr.data-target]="'#demo' + s + d" data-toggle="collapse">{{d+1}}. {{dept.department}}</legend>
              <div [attr.id]="'demo' + s + d" class="collapse" [ngClass]="d?'':'in'">
                <div class="row">
                  <div>
                    <div>
                      <div>
                        Action Steps
                      </div>
                    </div>
                    <div>
                      <table class="table table-striped">
                        <thead>
                          <tr>
                            <th>*</th>
                            <th>Action</th>
                            <th>Root Cause</th>
                            <th>Resources</th>
                            <th>Deadline</th>
                            <th *ngIf="!my">Assigned</th>
                            <th *ngIf="!my">Edit</th>
                            <th *ngIf="my">Fill</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let step of dept.stepInfo;let s = index;">
                            <th>{{s+1}}</th>
                            <td>{{step.description}}</td>
                            <td>{{step.reason}}</td>
                            <td>{{step.resources}}</td>
                            <td>{{step.deadline}}</td>
                            <td *ngIf="!my">
                              <ul class="list-group list-group-flush">
                                <li class="list-group-item bg-transparent" *ngFor="let emp of step.employeeAssigned;let i = index;">
                                  {{emp.firstName + emp.lastName}}
                                </li>
                                <a class="text-primary link primary-link float-right" (click)="showList(step)">Assign</a>
                              </ul>
                            </td>
                            <td *ngIf="!my">
                              <button class="btn btn-link" (click)="editActionStep(step)" data-toggle="modal" data-target="#myModal"> <i class="fas fa-edit"></i></button>
                            </td>
                            <td *ngIf="my">
                                <button type="button" class="btn btn-link" data-toggle="modal" data-target="#postActionModal" (click)="selectedStep=step" *ngIf="step.statusLogs&&!step.statusLogs.length">Set Status</button>
                                <span *ngIf="step.statusLogs&&step.statusLogs.length">{{step.statusLogs[0].status}}</span>
                            </td>
                          </tr>
                        </tbody>
                            <!-- No content -->
                          <div no-content *ngIf="!dept.stepInfo.length">
                              Data not available
                            </div>
                            <!-- end of no content -->
                      </table>

                  <!-- ASSIGN EMP LIST -->
                  <div class="emp-list">
                      <div class="d-flex justify-content-center mx-5 px-5">
                          <div>Assign employee</div>
                          <select class="custom-select custom-select-sm" multiple id="toggle-list" [(ngModel)]="employeeIds">
                              <option *ngFor="let emp of employees;let i = index;" [ngValue]="emp" [selected]="emp.assigned" [disabled]="emp.assigned">{{emp.firstName + emp.lastName}}</option>
                          </select>
                          <div>
                              <button class="btn btn-link" type="button" [disabled]="!employeeIds" (click)="assignEmployee()">
                                  <i class="fas fa-check-circle"></i>
                              </button>
                              <button class="btn btn-link" type="button" (click)="hideList()">
                                  <i class="fas fa-times-circle"></i>
                              </button>
                          </div>
                      </div>
                      <div class='text-center '><small class="text-secondary"><b>Note: </b>Hold ctrl/cmd for multiple selection</small></div>
                    </div>
                    <!-- END OF ASSIGN EMP LIST -->

                    </div>
                  </div>
                </div>
              </div>
            </fieldset>
          </div>
        </div>
      </div>
    </div>
    <div class="panel text-center">
      <!-- No content -->
      <div no-content *ngIf="my&& !actionSteps.length">
          No Action Steps Assigned To You
        </div>
        <!-- end of no content -->
         <!-- No content -->
      <div no-content *ngIf="!my&& !actionSteps.length">
          No Action Steps are linked
        </div>
        <!-- end of no content -->
      <h4 *ngIf="my&& !actionSteps.length">No Action Steps Assigned To You</h4>
      <h4 *ngIf="!my&& !actionSteps.length">No Action Steps are linked</h4>      
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="myModal" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content" *ngIf="selectedStep">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">{{selectedStep.description}}</h4>
      </div>
      <form class="form-horizontal" [formGroup]="actionForm" (submit)="onSubmit()">
        <div class="modal-body">
          <div class="form-group">
            <label class="control-label col-sm-2">Description</label>
            <div class="col-sm-10">
              <textarea class="form-control" formControlName="description"></textarea>
            </div>
          </div>
          <div class="form-group">
            <label class="control-label col-sm-2">Reason</label>
            <div class="col-sm-10">
              <textarea class="form-control" formControlName="reason"></textarea>
            </div>
          </div>
          <div class="form-group">
            <label class="control-label col-sm-2">Resources</label>
            <div class="col-sm-10">
              <textarea class="form-control" formControlName="resources"></textarea>
            </div>
          </div>
          <div class="form-group">
            <label class="control-label col-sm-2">Deadline</label>
            <div class="col-sm-10">
              <input class="form-control" type="date" formControlName="deadline">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Submit</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </form>

    </div>

  </div>
</div>

<!--post Action Modal -->
<div class="modal fade" id="postActionModal" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content" *ngIf="selectedStep">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">{{selectedStep.description}}</h4>
      </div>
      <form [formGroup]="statusForm" (submit)="onStatusSubmit()">
        <div class="modal-body">
          <div class="row form-group">
            <label class="control-label col-lg-2">Status</label>
            <div class="col-lg-10">
              <select class="form-control" formControlName="status">
                <option value="inprogress">Inprogress</option>
                <option value="onhold">Onhold</option>
                <option value="completed">Completed</option>
              </select>
            </div>
          </div>
          <div class="row form-group">
            <label class="control-label col-lg-2">Comment</label>
            <div class="col-lg-10">
              <textarea class="form-control" formControlName="comment"></textarea>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success"[disabled]="statusForm.invalid">Submit</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </form>
    </div>
    
  </div>
</div>